{"version":3,"file":"index.umd.js","sources":["../sets/warnings.js","../utils/listeners.js","../index.js"],"sourcesContent":["/**\n * @overview Console warnings\n */\nconst INITIAL = \"extended-click-outside:\";\n\nexport const ALREADY_HAS_LISTENER = `${INITIAL} element already has extended click outside listener`;\nexport const INVALID_ELEMENT = `${INITIAL} element must be a valid HTMLElement`;\nexport const INVALID_LISTENER = `${INITIAL} listener must be a function`;\nexport const MISSING_ELEMENT = `${INITIAL} element has no click outside listener`;\nexport const OUTSIDE_OF_DOCUMENT = `${INITIAL} can not run outside a document`;\n","/**\n * Determines whether given element is inside\n * root ExtendedClickOutside instance element\n * @function\n * @param {HTMLElement} element - ExtendedClickOutside root element\n * @param {HTMLElement} target - target of \"click/touchstart\" event\n * @returns {boolean} location\n */\nconst isParentElement = (element, target) => {\n  let currentTarget = target.parentNode;\n\n  while (currentTarget) {\n    if (currentTarget === element) return true;\n    if (currentTarget === document.documentElement || !currentTarget) return false;\n\n    currentTarget = currentTarget.parentNode;\n  }\n};\n\n/**\n * Determines whether to block ExtendedClickOutside\n * listener by special keys combination\n * @function\n * @param {MouseEvent} event - MouseEvent instance\n * @param {Array} [blockKeys] - list of keys\n * @returns {boolean} restriction\n */\nconst blockByKeys = (event, blockKeys) => {\n  switch (true) {\n    case !blockKeys || !blockKeys.length:\n      return false;\n    case event.altKey && blockKeys.includes(\"alt\"):\n      return true;\n    case event.ctrlKey && blockKeys.includes(\"ctrl\"):\n      return true;\n    case event.shiftKey && blockKeys.includes(\"shift\"):\n      return true;\n    default:\n      return false;\n  }\n};\n\n/**\n * Sets reusable ExtendedClickOutside listener\n * @function\n * @param {HTMLElement} element - ExtendedClickOutside root element\n * @param {Function} listener - ExtendedClickOutside listener\n * @param {boolean} capture - event \"capture\" flag\n * @param {boolean} selfOnly - only current element flag\n * @param {Array} blockKeys - list of keys\n * @param {string} eventName - type of event\n * @returns {Function} handler\n */\nexport const setListener = (\n  element,\n  listener,\n  capture,\n  passive,\n  selfOnly,\n  blockKeys,\n  eventName,\n) => {\n  const handler = (event) => {\n    const target = event.target;\n\n    if (target === element) return;\n    if (!selfOnly && isParentElement(element, target)) return;\n    if (blockByKeys(event, blockKeys)) return;\n\n    listener(event);\n  };\n\n  document.documentElement.addEventListener(eventName, handler, {\n    capture,\n    passive,\n  });\n\n  return handler;\n};\n\n/**\n * Sets disposable ExtendedClickOutside listener\n * @function\n * @param {HTMLElement} element - ExtendedClickOutside root element\n * @param {Function} listener - ExtendedClickOutside listener\n * @param {boolean} capture - event \"capture\" flag\n * @param {boolean} selfOnly - only current element flag\n * @param {Array} blockKeys - list of keys\n * @param {string} eventName - type of event\n * @param {Function} callback - removal of listener\n * @returns {Function} handler\n */\nexport const setListenerOnce = (\n  element,\n  listener,\n  capture,\n  passive,\n  selfOnly,\n  blockKeys,\n  eventName,\n  callback,\n) => {\n  const handler = (event) => {\n    const target = event.target;\n\n    if (target === element) return;\n    if (!selfOnly && isParentElement(element, target)) return;\n    if (blockByKeys(event, blockKeys)) return;\n\n    listener(event);\n    document.documentElement.removeEventListener(eventName, handler, {\n      capture,\n      passive,\n    });\n    callback();\n  };\n\n  document.documentElement.addEventListener(eventName, handler, {\n    capture,\n    passive,\n  });\n\n  return handler;\n};\n","import {\n  ALREADY_HAS_LISTENER,\n  INVALID_ELEMENT,\n  INVALID_LISTENER,\n  MISSING_ELEMENT,\n  OUTSIDE_OF_DOCUMENT,\n} from \"./sets/warnings\";\n\nimport { setListener, setListenerOnce } from \"./utils/listeners\";\n\n/**\n * ExtendedClickOutside instance constructor\n * @author Ridiger Daniil Dmitrievich, 2023\n * @class\n * @version 3.0.0\n */\nexport default class ExtendedClickOutside {\n  _clickName = !document.ontouchstart ? \"click\" : \"touchstart\";\n  _outsideListeners = new Map();\n\n  /**\n   * Initializes ExtendedClickOutside listener\n   * @method\n   * @param {HTMLElement} element - ExtendedClickOutside root element\n   * @param {Function} listener - ExtendedClickOutside listener\n   * @param {Object} [config={}] - configuration\n   */\n  init(element, listener, config = {}) {\n    let handler;\n    const blockKeys = config.blockKeys || [];\n    const capture = config.capture || false;\n    const passive = config.passive || false;\n    const once = config.once || false;\n    const selfOnly = config.selfOnly || false;\n    const useWarnings = config.useWarnings || false;\n\n    if (!element || typeof element !== \"object\") {\n      useWarnings && console.warn(INVALID_ELEMENT);\n\n      return;\n    }\n\n    if (!listener || typeof listener !== \"function\") {\n      useWarnings && console.warn(INVALID_LISTENER);\n\n      return;\n    }\n\n    if (!window || !document || !document.documentElement) {\n      useWarnings && console.warn(OUTSIDE_OF_DOCUMENT);\n\n      return;\n    }\n\n    if (this._outsideListeners.has(element)) {\n      useWarnings && console.warn(ALREADY_HAS_LISTENER);\n\n      return;\n    }\n\n    if (!element || !(element instanceof HTMLElement)) {\n      useWarnings && console.warn(INVALID_ELEMENT);\n\n      return;\n    }\n\n    if (once) {\n      handler = setListenerOnce(\n        element,\n        listener,\n        capture,\n        passive,\n        selfOnly,\n        blockKeys,\n        this._clickName,\n        () => this._outsideListeners.delete(element),\n      );\n    } else {\n      handler = setListener(\n        element,\n        listener,\n        capture,\n        passive,\n        selfOnly,\n        blockKeys,\n        this._clickName,\n      );\n    }\n\n    this._outsideListeners.set(element, {\n      handler,\n      options: {\n        capture,\n        passive,\n      },\n    });\n  }\n\n  /**\n   * Removes ExtendedClickOutside listener\n   * @method\n   * @param {HTMLElement} element - ExtendedClickOutside root element\n   * @param {boolean} [useWarnings=false] - console warnings flag\n   */\n  remove(element, useWarnings = false) {\n    if (!this._outsideListeners.has(element)) {\n      useWarnings && console.warn(MISSING_ELEMENT);\n\n      return;\n    }\n\n    const listener = this._outsideListeners.get(element);\n\n    document.documentElement.removeEventListener(\n      \"click\",\n      listener.handler,\n      listener.options,\n    );\n\n    this._outsideListeners.delete(element);\n  }\n\n  /**\n   * Removes all ExtendedClickOutside listeners\n   * @method\n   */\n  removeAllListeners() {\n    for (let listener of this._outsideListeners.values()) {\n      document.documentElement.removeEventListener(\n        \"click\",\n        listener.handler,\n        listener.options,\n      );\n    }\n\n    this._outsideListeners.clear();\n  }\n\n  /**\n   * Checks if a listener exists for the given element\n   * @method\n   * @param {HTMLElement} element - ExtendedClickOutside root element\n   * @returns {boolean} listener existen—Åe flag\n   */\n  isListenerExisting(element) {\n    return this._outsideListeners.has(element);\n  }\n\n  /**\n   * Writes root ExtendedClickOutside elements to snapshots list\n   * @method\n   * @returns {Array} snapshots\n   */\n  getCurrentSnapshots() {\n    let output = [];\n\n    for (let element of this._outsideListeners.keys()) {\n      const snapshot = element.outerHTML.match(/^(<.+?>)/is)[0];\n      output.push(snapshot);\n    }\n\n    return output;\n  }\n\n  /**\n   * Writes current ExtendedClickOutside listeners count\n   * @method\n   * @returns {number} count\n   */\n  getListenersCount() {\n    return this._outsideListeners.size;\n  }\n}\n"],"names":["INITIAL","ALREADY_HAS_LISTENER","INVALID_ELEMENT","INVALID_LISTENER","MISSING_ELEMENT","OUTSIDE_OF_DOCUMENT","isParentElement","element","target","currentTarget","parentNode","document","documentElement","blockByKeys","event","blockKeys","length","altKey","includes","ctrlKey","shiftKey","_createClass","ExtendedClickOutside","_classCallCheck","_defineProperty","this","ontouchstart","Map","key","value","listener","config","_this","handler","capture","passive","once","selfOnly","useWarnings","window","_outsideListeners","has","console","warn","HTMLElement","eventName","callback","removeEventListener","addEventListener","setListenerOnce","_clickName","delete","setListener","set","options","get","values","clear","output","keys","snapshot","outerHTML","match","push","size"],"mappings":"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"}